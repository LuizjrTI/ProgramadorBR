## FIREBASE - CRIANDO A CONTA NO FIREBASE

Link de acesso : [FIREBASE](https://https://firebase.google.com/?hl=pt)

## FIREBASE - LENDO DOCUMENTOS

**HTML**

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./css/style.css" />
    <title>Firebase</title>
  </head>
  <body></body>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  <script src="./script/app.js"></script>
</html>
```

**JAVASCRIPT**

```JavaScript
const firebaseConfig = {
  apiKey: "AIzaSyDlNGLlPqTnv9mXMRzlDoyDZaxGgDbuAsk",
  authDomain: "colegio-e8df5.firebaseapp.com",
  projectId: "colegio-e8df5",
  storageBucket: "colegio-e8df5.appspot.com",
  messagingSenderId: "442934886663",
  appId: "1:442934886663:web:31af2aa9739d3b24b105a2",
  measurementId: "G-6WVCMGTFJT",
};
const firebaseApp = firebase.initializeApp(firebaseConfig);
const db = firebaseApp.firestore();

db.collection("turmaA")
  .get()
  .then((snapshot) => {
    snapshot.forEach((doc) => {
      console.log(doc.id, " => ", doc.data());
      let aluno = doc.data();
      console.log("üöÄ ~ snapshot.forEach ~ aluno:", aluno.nome);
    });
  });

```

## FIREBASE - BUSCAS SELECIONANDO MELHOR OS DOCUMENTOS

```JavaScript
const firebaseConfig = {
  apiKey: "AIzaSyDlNGLlPqTnv9mXMRzlDoyDZaxGgDbuAsk",
  authDomain: "colegio-e8df5.firebaseapp.com",
  projectId: "colegio-e8df5",
  storageBucket: "colegio-e8df5.appspot.com",
  messagingSenderId: "442934886663",
  appId: "1:442934886663:web:31af2aa9739d3b24b105a2",
  measurementId: "G-6WVCMGTFJT",
};
const firebaseApp = firebase.initializeApp(firebaseConfig);
const db = firebaseApp.firestore();

// Exemplo 1
db.collection("turmaA")
  .where("notas.nota1", ">", 7)
  .get()
  .then((snapshot) => {
    snapshot.forEach((doc) => {
      let aluno = doc.data();

      console.log(aluno.nome + " => " + aluno.notas.nota1);
    });
  });

// Exemplo 2
db.collection("turmaA")
  .where("nome", ">", "M")
  .where("nome", "<", "Z")
  .get()
  .then((snapshot) => {
    snapshot.forEach((doc) => {
      let aluno = doc.data();
      console.log(aluno.nome);
    });
  });

```

- No where ele aceita **`==`**,**`>`**,**`>=`**,**`<`**,**`<=`**.
- Ele n√£o permite o uso do **`!=`**,

## FIREBASE - CRIANDO E ALTERANDO DOCUMENTOS

```javascript
const firebaseConfig = {
  apiKey: "AIzaSyDlNGLlPqTnv9mXMRzlDoyDZaxGgDbuAsk",
  authDomain: "colegio-e8df5.firebaseapp.com",
  projectId: "colegio-e8df5",
  storageBucket: "colegio-e8df5.appspot.com",
  messagingSenderId: "442934886663",
  appId: "1:442934886663:web:31af2aa9739d3b24b105a2",
  measurementId: "G-6WVCMGTFJT",
};
const firebaseApp = firebase.initializeApp(firebaseConfig);
const db = firebaseApp.firestore();

const TURMA = "turmaA";

db.collection(TURMA) // id
  .add({
    nome: "Marcos",
    sobrenome: "Souza",
    notas: {
      nota1: 9.8,
      nota2: 5.7,
    },
  })
  .then((doc) => {
    console.log("Documento Inserido com sucesso:", doc);
  })
  .catch((err) => {
    console.log(err);
  });

db.collection(TURMA)
  .doc("ALuno") // id
  .set(
    {
      nome: "Matheus",
      sobrenome: "Souza",
      notas: {
        nota1: 9.8,
        nota2: 5.7,
      },
    },
    { merge: true }
  )
  .then(() => {
    console.log("Documento Inserido com sucesso:");
  })
  .catch((err) => {
    console.log(err);
  });

db.collection(TURMA)
  .doc("ALuno") // id
  .update({
    cidade: firebase.firestore.FieldValue.arrayUnion("Vitoria", "S√£o Paulo"),
    cidade: firebase.firestore.FieldValue.arrayRemove("Vitoria"),
    faltas: firebase.firestore.FieldValue.increment(1),
    //cidade: ["Rio de Janeiro"],
  })
  .then(() => {
    console.log("Documento Inserido com sucesso:");
  })
  .catch((err) => {
    console.log(err);
  });
```

## FIREBASE - ON SNAPSHOT (ATUALIZANDO EM TEMPO REAL )

```javascript
const firebaseConfig = {
  apiKey: "AIzaSyDlNGLlPqTnv9mXMRzlDoyDZaxGgDbuAsk",
  authDomain: "colegio-e8df5.firebaseapp.com",
  projectId: "colegio-e8df5",
  storageBucket: "colegio-e8df5.appspot.com",
  messagingSenderId: "442934886663",
  appId: "1:442934886663:web:31af2aa9739d3b24b105a2",
  measurementId: "G-6WVCMGTFJT",
};
const firebaseApp = firebase.initializeApp(firebaseConfig);
const db = firebaseApp.firestore();

const TURMA = "turmaA";

db.collection("turmaA").onSnapshot((snapshot) => {
  snapshot.forEach((doc) => {
    console.log(doc.id, " => ", doc.data());
    let aluno = doc.data();
    console.log("üöÄ ~ snapshot.forEach ~ aluno:", aluno.nome);
  });
});
```

## FIREBASE - APAGANDO CAMPOS E DOCUMENTOS

- Para deletar um **CAMPO**

```javascript
const firebaseConfig = {
  apiKey: "AIzaSyDlNGLlPqTnv9mXMRzlDoyDZaxGgDbuAsk",
  authDomain: "colegio-e8df5.firebaseapp.com",
  projectId: "colegio-e8df5",
  storageBucket: "colegio-e8df5.appspot.com",
  messagingSenderId: "442934886663",
  appId: "1:442934886663:web:31af2aa9739d3b24b105a2",
  measurementId: "G-6WVCMGTFJT",
};
const firebaseApp = firebase.initializeApp(firebaseConfig);
const db = firebaseApp.firestore();

const TURMA = "turmaA";

db.collection(TURMA)
  .doc("ALuno") // id
  .update({
    cidade: firebase.firestore.FieldValue.delete(),
  })
  .then(() => {
    console.log("Documento Inserido com sucesso:");
  })
  .catch((err) => {
    console.log(err);
  });
```

- Para deletar um **Documento**

```javascript
const firebaseConfig = {
  apiKey: "AIzaSyDlNGLlPqTnv9mXMRzlDoyDZaxGgDbuAsk",
  authDomain: "colegio-e8df5.firebaseapp.com",
  projectId: "colegio-e8df5",
  storageBucket: "colegio-e8df5.appspot.com",
  messagingSenderId: "442934886663",
  appId: "1:442934886663:web:31af2aa9739d3b24b105a2",
  measurementId: "G-6WVCMGTFJT",
};
const firebaseApp = firebase.initializeApp(firebaseConfig);
const db = firebaseApp.firestore();

const TURMA = "turmaA";

db.collection(TURMA)
  .doc("ALuno") // id
  .delete()
  .then(() => {
    console.log("Documento deletado com sucesso:");
  })
  .catch((err) => {
    console.log(err);
  });
```

## FIREBASE - CRIANDO USUARIOS NO FIREBASE

```html
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
```

```javascript
const firebaseConfig = {
  apiKey: "AIzaSyDlNGLlPqTnv9mXMRzlDoyDZaxGgDbuAsk",
  authDomain: "colegio-e8df5.firebaseapp.com",
  projectId: "colegio-e8df5",
  storageBucket: "colegio-e8df5.appspot.com",
  messagingSenderId: "442934886663",
  appId: "1:442934886663:web:31af2aa9739d3b24b105a2",
  measurementId: "G-6WVCMGTFJT",
};
const firebaseApp = firebase.initializeApp(firebaseConfig);
const db = firebaseApp.firestore();

let newUserEmail = "novoteste@teste.com";
let newUserPassword = "123321ABCcba";

let auth = firebase.auth();

auth
  .createUserWithEmailAndPassword(newUserEmail, newUserPassword)
  .then((user) => {
    console.log("User created");
  })
  .catch((error) => {
    console.log(error);
  });
```

## FIREBASE - GERENCIANDO LOGINS

- O Firebase √© uma plataforma poderosa para desenvolvimento de aplicativos m√≥veis e web, que fornece uma variedade de servi√ßos, incluindo autentica√ß√£o de usu√°rios. O gerenciamento de logins no Firebase permite que os desenvolvedores autentiquem usu√°rios de forma segura e eficiente, utilizando diferentes m√©todos de autentica√ß√£o, como e-mail/senha, Google, Facebook, Twitter, entre outros.

- No exemplo fornecido, o c√≥digo JavaScript demonstra como realizar o login de um usu√°rio utilizando o m√©todo **`signInWithEmailAndPassword()`** do Firebase Auth para autenticar um usu√°rio por e-mail e senha. Ap√≥s o login bem-sucedido, √© poss√≠vel acessar informa√ß√µes sobre o usu√°rio autenticado e tamb√©m monitorar mudan√ßas no estado de autentica√ß√£o utilizando o m√©todo **`onAuthStateChanged()`** . Al√©m disso, o c√≥digo tamb√©m demonstra como realizar o logout de um usu√°rio utilizando o m√©todo **`signOut()`** .

* O m√©todo **`onAuthStateChanged()`** √© usado para monitorar mudan√ßas no estado de autentica√ß√£o do usu√°rio. Sempre que o estado de autentica√ß√£o do usu√°rio mudar (por exemplo, quando um usu√°rio faz login ou logout), a fun√ß√£o de retorno de chamada fornecida ser√° executada. Se um usu√°rio estiver autenticado, o objeto user conter√° informa√ß√µes sobre o usu√°rio. Caso contr√°rio, o valor de user ser√° null.

```javascript
const firebaseConfig = {
  apiKey: "AIzaSyDlNGLlPqTnv9mXMRzlDoyDZaxGgDbuAsk",
  authDomain: "colegio-e8df5.firebaseapp.com",
  projectId: "colegio-e8df5",
  storageBucket: "colegio-e8df5.appspot.com",
  messagingSenderId: "442934886663",
  appId: "1:442934886663:web:31af2aa9739d3b24b105a2",
  measurementId: "G-6WVCMGTFJT",
};
const firebaseApp = firebase.initializeApp(firebaseConfig);
const db = firebaseApp.firestore();
let auth = firebaseApp.auth();

function criarUsuario() {
  let newUserEmail = "novoteste@teste.com";
  let newUserPassword = "123321ABCcba";

  let auth = firebase.auth();

  auth
    .createUserWithEmailAndPassword(newUserEmail, newUserPassword)
    .then((user) => {
      console.log("User created");
    })
    .catch((error) => {
      console.log(error);
    });
}

function login() {
  let newUserEmail = "novoteste@teste.com";
  let newUserPassword = "123321ABCcba";

  auth
    .signInWithEmailAndPassword(newUserEmail, newUserPassword)
    .then((loggedUser) => {
      console.log(
        "üöÄ ~ auth.signInWithEmailAndPassword ~ loggedUser:",
        loggedUser
      );
      console.log(
        "üöÄ ~ auth.signInWithEmailAndPassword ~ auth.currentUser:",
        auth.currentUser
      );
    })
    .catch((error) => {
      console.log(error);
    });
}

//login();

auth.onAuthStateChanged((user) => {
  if (user) {
    console.log(user);
  } else {
    console.log("Niguem logado");
  }
});

function logout() {
  auth
    .signOut()
    .then(() => {
      console.log("Usuario foi deslogado");
    })
    .catch((error) => {
      console.log(error);
    });
}

setTimeout(() => {
  logout();
}, 2000);
```

## FIREBASE - SESS√ÉO DE USUARIOS

- O Firebase Authentication √© um servi√ßo oferecido pela plataforma Firebase que permite autenticar usu√°rios em seus aplicativos. Para gerenciar a sess√£o de usu√°rios, o Firebase Authentication oferece tr√™s op√ß√µes de persist√™ncia de sess√£o, que determinam como a autentica√ß√£o do usu√°rio √© mantida entre sess√µes e se ele ser√° mantido conectado mesmo ap√≥s o fechamento do navegador ou a reinicializa√ß√£o do aplicativo.

**firebase.auth.Auth.Persistence.NONE:**

- Com essa op√ß√£o, a sess√£o de autentica√ß√£o do usu√°rio n√£o ser√° mantida entre sess√µes. Isso significa que, ao fechar o navegador ou reiniciar o aplicativo, o usu√°rio ser√° automaticamente desconectado e precisar√° fazer login novamente na pr√≥xima vez que acessar o aplicativo.
- Esta op√ß√£o √© √∫til em situa√ß√µes onde voc√™ deseja garantir que o usu√°rio fa√ßa login sempre que acessar o aplicativo, sem manter sua sess√£o ativa entre sess√µes.

**firebase.auth.Auth.Persistence.LOCAL:**

- Com essa op√ß√£o, a sess√£o de autentica√ß√£o do usu√°rio √© mantida localmente no dispositivo do usu√°rio, mesmo ap√≥s o fechamento do navegador ou a reinicializa√ß√£o do aplicativo. Isso significa que o usu√°rio permanecer√° conectado automaticamente quando acessar o aplicativo novamente.
- Esta op√ß√£o √© ideal para aplicativos onde voc√™ deseja que os usu√°rios permane√ßam conectados entre sess√µes e n√£o precisem fazer login repetidamente.

**firebase.auth.Auth.Persistence.SESSION:**

- Com essa op√ß√£o, a sess√£o de autentica√ß√£o do usu√°rio √© mantida apenas durante a sess√£o atual do navegador ou do aplicativo. Isso significa que, ao fechar o navegador ou reiniciar o aplicativo, o usu√°rio ser√° desconectado e precisar√° fazer login novamente na pr√≥xima vez que acessar o aplicativo.
- Esta op√ß√£o √© √∫til em cen√°rios onde voc√™ deseja manter os usu√°rios conectados durante a sess√£o atual, mas n√£o deseja manter a sess√£o ativa entre sess√µes.

- Essas op√ß√µes de persist√™ncia de sess√£o oferecidas pelo Firebase Authentication permitem personalizar o comportamento de autentica√ß√£o do usu√°rio de acordo com as necessidades espec√≠ficas do seu aplicativo. √â importante escolher a op√ß√£o mais adequada com base nos requisitos de seguran√ßa e usabilidade do seu aplicativo.

```javascript
function login() {
  let newUserEmail = "novoteste@teste.com";
  let newUserPassword = "123321ABCcba";

  auth
    .setPersistence(firebase.auth.Auth.Persistence.NONE)
    .then(
      auth
        .signInWithEmailAndPassword(newUserEmail, newUserPassword)
        .then((loggedUser) => {
          console.log(
            "üöÄ ~ auth.signInWithEmailAndPassword ~ loggedUser:",
            loggedUser
          );
          console.log(
            "üöÄ ~ auth.signInWithEmailAndPassword ~ auth.currentUser:",
            auth.currentUser
          );
        })
        .catch((error) => {
          console.log(error);
        })
    )
    .catch((error) => {
      console.log(error);
    });
}
```

## FIREBASE PERMISS√ïES E REGRAS

**Algumas regras comuns:**

- Somente Usu√°rios autenticados podem ler ou modificar:

```
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}
```

- ‚ÄãSomente os donos do conte√∫do podem ler ou modificar:

```
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow only authenticated content owners access
    match /some_collection/{userId}/{documents=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId
    }
  }
}
```

- Todos podem ler mas apenas os donos do conte√∫do podem modificar:

```
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow public read access, but only content owners can write
    match /some_collection/{document} {
      allow read: if true
      allow create: if request.auth.uid == request.resource.data.author_uid;
      allow update, delete: if request.auth.uid == resource.data.author_uid;
    }
  }
}
```

- Permiss√£o baseada no papel do usu√°rio:

```
service cloud.firestore {
  match /databases/{database}/documents {
    // For attribute-based access control, Check a boolean `admin` attribute
    allow write: if get(/databases/$(database)/documents/users/$(request.auth.uid)).data.admin == true;
    allow read: true;

    // Alterntatively, for role-based access, assign specific roles to users
    match /some_collection/{document} {
     allow read: if get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == "Reader"
     allow write: if get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == "Writer"
   }
  }
}
```
