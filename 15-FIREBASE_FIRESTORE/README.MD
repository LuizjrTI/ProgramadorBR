## FIREBASE - CRIANDO A CONTA NO FIREBASE

Link de acesso : [FIREBASE](https://https://firebase.google.com/?hl=pt)

## FIREBASE - LENDO DOCUMENTOS

**HTML**

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./css/style.css" />
    <title>Firebase</title>
  </head>
  <body></body>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  <script src="./script/app.js"></script>
</html>
```

**JAVASCRIPT**

```JavaScript
const firebaseConfig = {
  apiKey: "AIzaSyDlNGLlPqTnv9mXMRzlDoyDZaxGgDbuAsk",
  authDomain: "colegio-e8df5.firebaseapp.com",
  projectId: "colegio-e8df5",
  storageBucket: "colegio-e8df5.appspot.com",
  messagingSenderId: "442934886663",
  appId: "1:442934886663:web:31af2aa9739d3b24b105a2",
  measurementId: "G-6WVCMGTFJT",
};
const firebaseApp = firebase.initializeApp(firebaseConfig);
const db = firebaseApp.firestore();

db.collection("turmaA")
  .get()
  .then((snapshot) => {
    snapshot.forEach((doc) => {
      console.log(doc.id, " => ", doc.data());
      let aluno = doc.data();
      console.log("ðŸš€ ~ snapshot.forEach ~ aluno:", aluno.nome);
    });
  });

```

## FIREBASE - BUSCAS SELECIONANDO MELHOR OS DOCUMENTOS

```JavaScript
const firebaseConfig = {
  apiKey: "AIzaSyDlNGLlPqTnv9mXMRzlDoyDZaxGgDbuAsk",
  authDomain: "colegio-e8df5.firebaseapp.com",
  projectId: "colegio-e8df5",
  storageBucket: "colegio-e8df5.appspot.com",
  messagingSenderId: "442934886663",
  appId: "1:442934886663:web:31af2aa9739d3b24b105a2",
  measurementId: "G-6WVCMGTFJT",
};
const firebaseApp = firebase.initializeApp(firebaseConfig);
const db = firebaseApp.firestore();

// Exemplo 1
db.collection("turmaA")
  .where("notas.nota1", ">", 7)
  .get()
  .then((snapshot) => {
    snapshot.forEach((doc) => {
      let aluno = doc.data();

      console.log(aluno.nome + " => " + aluno.notas.nota1);
    });
  });

// Exemplo 2
db.collection("turmaA")
  .where("nome", ">", "M")
  .where("nome", "<", "Z")
  .get()
  .then((snapshot) => {
    snapshot.forEach((doc) => {
      let aluno = doc.data();
      console.log(aluno.nome);
    });
  });

```

- No where ele aceita **`==`**,**`>`**,**`>=`**,**`<`**,**`<=`**.
- Ele nÃ£o permite o uso do **`!=`**,

## FIREBASE - CRIANDO E ALTERANDO DOCUMENTOS

```javascript
const firebaseConfig = {
  apiKey: "AIzaSyDlNGLlPqTnv9mXMRzlDoyDZaxGgDbuAsk",
  authDomain: "colegio-e8df5.firebaseapp.com",
  projectId: "colegio-e8df5",
  storageBucket: "colegio-e8df5.appspot.com",
  messagingSenderId: "442934886663",
  appId: "1:442934886663:web:31af2aa9739d3b24b105a2",
  measurementId: "G-6WVCMGTFJT",
};
const firebaseApp = firebase.initializeApp(firebaseConfig);
const db = firebaseApp.firestore();

const TURMA = "turmaA";

db.collection(TURMA) // id
  .add({
    nome: "Marcos",
    sobrenome: "Souza",
    notas: {
      nota1: 9.8,
      nota2: 5.7,
    },
  })
  .then((doc) => {
    console.log("Documento Inserido com sucesso:", doc);
  })
  .catch((err) => {
    console.log(err);
  });

db.collection(TURMA)
  .doc("ALuno") // id
  .set(
    {
      nome: "Matheus",
      sobrenome: "Souza",
      notas: {
        nota1: 9.8,
        nota2: 5.7,
      },
    },
    { merge: true }
  )
  .then(() => {
    console.log("Documento Inserido com sucesso:");
  })
  .catch((err) => {
    console.log(err);
  });

db.collection(TURMA)
  .doc("ALuno") // id
  .update({
    cidade: firebase.firestore.FieldValue.arrayUnion("Vitoria", "SÃ£o Paulo"),
    cidade: firebase.firestore.FieldValue.arrayRemove("Vitoria"),
    faltas: firebase.firestore.FieldValue.increment(1),
    //cidade: ["Rio de Janeiro"],
  })
  .then(() => {
    console.log("Documento Inserido com sucesso:");
  })
  .catch((err) => {
    console.log(err);
  });
```

## FIREBASE - ON SNAPSHOT (ATUALIZANDO EM TEMPO REAL )

```javascript
const firebaseConfig = {
  apiKey: "AIzaSyDlNGLlPqTnv9mXMRzlDoyDZaxGgDbuAsk",
  authDomain: "colegio-e8df5.firebaseapp.com",
  projectId: "colegio-e8df5",
  storageBucket: "colegio-e8df5.appspot.com",
  messagingSenderId: "442934886663",
  appId: "1:442934886663:web:31af2aa9739d3b24b105a2",
  measurementId: "G-6WVCMGTFJT",
};
const firebaseApp = firebase.initializeApp(firebaseConfig);
const db = firebaseApp.firestore();

const TURMA = "turmaA";

db.collection("turmaA").onSnapshot((snapshot) => {
  snapshot.forEach((doc) => {
    console.log(doc.id, " => ", doc.data());
    let aluno = doc.data();
    console.log("ðŸš€ ~ snapshot.forEach ~ aluno:", aluno.nome);
  });
});
```

## FIREBASE - APAGANDO CAMPOS E DOCUMENTOS

- Para deletar um **CAMPO**

```javascript
const firebaseConfig = {
  apiKey: "AIzaSyDlNGLlPqTnv9mXMRzlDoyDZaxGgDbuAsk",
  authDomain: "colegio-e8df5.firebaseapp.com",
  projectId: "colegio-e8df5",
  storageBucket: "colegio-e8df5.appspot.com",
  messagingSenderId: "442934886663",
  appId: "1:442934886663:web:31af2aa9739d3b24b105a2",
  measurementId: "G-6WVCMGTFJT",
};
const firebaseApp = firebase.initializeApp(firebaseConfig);
const db = firebaseApp.firestore();

const TURMA = "turmaA";

db.collection(TURMA)
  .doc("ALuno") // id
  .update({
    cidade: firebase.firestore.FieldValue.delete(),
  })
  .then(() => {
    console.log("Documento Inserido com sucesso:");
  })
  .catch((err) => {
    console.log(err);
  });
```

- Para deletar um **Documento**

```javascript
const firebaseConfig = {
  apiKey: "AIzaSyDlNGLlPqTnv9mXMRzlDoyDZaxGgDbuAsk",
  authDomain: "colegio-e8df5.firebaseapp.com",
  projectId: "colegio-e8df5",
  storageBucket: "colegio-e8df5.appspot.com",
  messagingSenderId: "442934886663",
  appId: "1:442934886663:web:31af2aa9739d3b24b105a2",
  measurementId: "G-6WVCMGTFJT",
};
const firebaseApp = firebase.initializeApp(firebaseConfig);
const db = firebaseApp.firestore();

const TURMA = "turmaA";

db.collection(TURMA)
  .doc("ALuno") // id
  .delete()
  .then(() => {
    console.log("Documento deletado com sucesso:");
  })
  .catch((err) => {
    console.log(err);
  });
```

## FIREBASE - CRIANDO USUARIOS NO FIREBASE

```html
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
```

```javascript
const firebaseConfig = {
  apiKey: "AIzaSyDlNGLlPqTnv9mXMRzlDoyDZaxGgDbuAsk",
  authDomain: "colegio-e8df5.firebaseapp.com",
  projectId: "colegio-e8df5",
  storageBucket: "colegio-e8df5.appspot.com",
  messagingSenderId: "442934886663",
  appId: "1:442934886663:web:31af2aa9739d3b24b105a2",
  measurementId: "G-6WVCMGTFJT",
};
const firebaseApp = firebase.initializeApp(firebaseConfig);
const db = firebaseApp.firestore();

let newUserEmail = "novoteste@teste.com";
let newUserPassword = "123321ABCcba";

let auth = firebase.auth();

auth
  .createUserWithEmailAndPassword(newUserEmail, newUserPassword)
  .then((user) => {
    console.log("User created");
  })
  .catch((error) => {
    console.log(error);
  });
```

## FIREBASE - GERENCIANDO LOGINS

- O Firebase Ã© uma plataforma poderosa para desenvolvimento de aplicativos mÃ³veis e web, que fornece uma variedade de serviÃ§os, incluindo autenticaÃ§Ã£o de usuÃ¡rios. O gerenciamento de logins no Firebase permite que os desenvolvedores autentiquem usuÃ¡rios de forma segura e eficiente, utilizando diferentes mÃ©todos de autenticaÃ§Ã£o, como e-mail/senha, Google, Facebook, Twitter, entre outros.

- No exemplo fornecido, o cÃ³digo JavaScript demonstra como realizar o login de um usuÃ¡rio utilizando o mÃ©todo **`signInWithEmailAndPassword()`** do Firebase Auth para autenticar um usuÃ¡rio por e-mail e senha. ApÃ³s o login bem-sucedido, Ã© possÃ­vel acessar informaÃ§Ãµes sobre o usuÃ¡rio autenticado e tambÃ©m monitorar mudanÃ§as no estado de autenticaÃ§Ã£o utilizando o mÃ©todo **`onAuthStateChanged()`** . AlÃ©m disso, o cÃ³digo tambÃ©m demonstra como realizar o logout de um usuÃ¡rio utilizando o mÃ©todo **`signOut()`** .

* O mÃ©todo **`onAuthStateChanged()`** Ã© usado para monitorar mudanÃ§as no estado de autenticaÃ§Ã£o do usuÃ¡rio. Sempre que o estado de autenticaÃ§Ã£o do usuÃ¡rio mudar (por exemplo, quando um usuÃ¡rio faz login ou logout), a funÃ§Ã£o de retorno de chamada fornecida serÃ¡ executada. Se um usuÃ¡rio estiver autenticado, o objeto user conterÃ¡ informaÃ§Ãµes sobre o usuÃ¡rio. Caso contrÃ¡rio, o valor de user serÃ¡ null.

```javascript
const firebaseConfig = {
  apiKey: "AIzaSyDlNGLlPqTnv9mXMRzlDoyDZaxGgDbuAsk",
  authDomain: "colegio-e8df5.firebaseapp.com",
  projectId: "colegio-e8df5",
  storageBucket: "colegio-e8df5.appspot.com",
  messagingSenderId: "442934886663",
  appId: "1:442934886663:web:31af2aa9739d3b24b105a2",
  measurementId: "G-6WVCMGTFJT",
};
const firebaseApp = firebase.initializeApp(firebaseConfig);
const db = firebaseApp.firestore();
let auth = firebaseApp.auth();

function criarUsuario() {
  let newUserEmail = "novoteste@teste.com";
  let newUserPassword = "123321ABCcba";

  let auth = firebase.auth();

  auth
    .createUserWithEmailAndPassword(newUserEmail, newUserPassword)
    .then((user) => {
      console.log("User created");
    })
    .catch((error) => {
      console.log(error);
    });
}

function login() {
  let newUserEmail = "novoteste@teste.com";
  let newUserPassword = "123321ABCcba";

  auth
    .signInWithEmailAndPassword(newUserEmail, newUserPassword)
    .then((loggedUser) => {
      console.log(
        "ðŸš€ ~ auth.signInWithEmailAndPassword ~ loggedUser:",
        loggedUser
      );
      console.log(
        "ðŸš€ ~ auth.signInWithEmailAndPassword ~ auth.currentUser:",
        auth.currentUser
      );
    })
    .catch((error) => {
      console.log(error);
    });
}

//login();

auth.onAuthStateChanged((user) => {
  if (user) {
    console.log(user);
  } else {
    console.log("Niguem logado");
  }
});

function logout() {
  auth
    .signOut()
    .then(() => {
      console.log("Usuario foi deslogado");
    })
    .catch((error) => {
      console.log(error);
    });
}

setTimeout(() => {
  logout();
}, 2000);
```

## FIREBASE - SESSÃƒO DE USUARIOS

- O Firebase Authentication Ã© um serviÃ§o oferecido pela plataforma Firebase que permite autenticar usuÃ¡rios em seus aplicativos. Para gerenciar a sessÃ£o de usuÃ¡rios, o Firebase Authentication oferece trÃªs opÃ§Ãµes de persistÃªncia de sessÃ£o, que determinam como a autenticaÃ§Ã£o do usuÃ¡rio Ã© mantida entre sessÃµes e se ele serÃ¡ mantido conectado mesmo apÃ³s o fechamento do navegador ou a reinicializaÃ§Ã£o do aplicativo.

**firebase.auth.Auth.Persistence.NONE:**

- Com essa opÃ§Ã£o, a sessÃ£o de autenticaÃ§Ã£o do usuÃ¡rio nÃ£o serÃ¡ mantida entre sessÃµes. Isso significa que, ao fechar o navegador ou reiniciar o aplicativo, o usuÃ¡rio serÃ¡ automaticamente desconectado e precisarÃ¡ fazer login novamente na prÃ³xima vez que acessar o aplicativo.
- Esta opÃ§Ã£o Ã© Ãºtil em situaÃ§Ãµes onde vocÃª deseja garantir que o usuÃ¡rio faÃ§a login sempre que acessar o aplicativo, sem manter sua sessÃ£o ativa entre sessÃµes.

**firebase.auth.Auth.Persistence.LOCAL:**

- Com essa opÃ§Ã£o, a sessÃ£o de autenticaÃ§Ã£o do usuÃ¡rio Ã© mantida localmente no dispositivo do usuÃ¡rio, mesmo apÃ³s o fechamento do navegador ou a reinicializaÃ§Ã£o do aplicativo. Isso significa que o usuÃ¡rio permanecerÃ¡ conectado automaticamente quando acessar o aplicativo novamente.
- Esta opÃ§Ã£o Ã© ideal para aplicativos onde vocÃª deseja que os usuÃ¡rios permaneÃ§am conectados entre sessÃµes e nÃ£o precisem fazer login repetidamente.

**firebase.auth.Auth.Persistence.SESSION:**

- Com essa opÃ§Ã£o, a sessÃ£o de autenticaÃ§Ã£o do usuÃ¡rio Ã© mantida apenas durante a sessÃ£o atual do navegador ou do aplicativo. Isso significa que, ao fechar o navegador ou reiniciar o aplicativo, o usuÃ¡rio serÃ¡ desconectado e precisarÃ¡ fazer login novamente na prÃ³xima vez que acessar o aplicativo.
- Esta opÃ§Ã£o Ã© Ãºtil em cenÃ¡rios onde vocÃª deseja manter os usuÃ¡rios conectados durante a sessÃ£o atual, mas nÃ£o deseja manter a sessÃ£o ativa entre sessÃµes.

- Essas opÃ§Ãµes de persistÃªncia de sessÃ£o oferecidas pelo Firebase Authentication permitem personalizar o comportamento de autenticaÃ§Ã£o do usuÃ¡rio de acordo com as necessidades especÃ­ficas do seu aplicativo. Ã‰ importante escolher a opÃ§Ã£o mais adequada com base nos requisitos de seguranÃ§a e usabilidade do seu aplicativo.

```javascript
function login() {
  let newUserEmail = "novoteste@teste.com";
  let newUserPassword = "123321ABCcba";

  auth
    .setPersistence(firebase.auth.Auth.Persistence.NONE)
    .then(
      auth
        .signInWithEmailAndPassword(newUserEmail, newUserPassword)
        .then((loggedUser) => {
          console.log(
            "ðŸš€ ~ auth.signInWithEmailAndPassword ~ loggedUser:",
            loggedUser
          );
          console.log(
            "ðŸš€ ~ auth.signInWithEmailAndPassword ~ auth.currentUser:",
            auth.currentUser
          );
        })
        .catch((error) => {
          console.log(error);
        })
    )
    .catch((error) => {
      console.log(error);
    });
}
```

## FIREBASE PERMISSÃ•ES E REGRAS

**Algumas regras comuns:**

- Somente UsuÃ¡rios autenticados podem ler ou modificar:

```
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}
```

- â€‹Somente os donos do conteÃºdo podem ler ou modificar:

```
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow only authenticated content owners access
    match /some_collection/{userId}/{documents=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId
    }
  }
}
```

- Todos podem ler mas apenas os donos do conteÃºdo podem modificar:

```
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow public read access, but only content owners can write
    match /some_collection/{document} {
      allow read: if true
      allow create: if request.auth.uid == request.resource.data.author_uid;
      allow update, delete: if request.auth.uid == resource.data.author_uid;
    }
  }
}
```

- PermissÃ£o baseada no papel do usuÃ¡rio:

```
service cloud.firestore {
  match /databases/{database}/documents {
    // For attribute-based access control, Check a boolean `admin` attribute
    allow write: if get(/databases/$(database)/documents/users/$(request.auth.uid)).data.admin == true;
    allow read: true;

    // Alterntatively, for role-based access, assign specific roles to users
    match /some_collection/{document} {
     allow read: if get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == "Reader"
     allow write: if get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == "Writer"
   }
  }
}
```
